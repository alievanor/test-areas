<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Test de Áreas – Orientación</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --bg:#f7f7fb; --card:#fff; --text:#222; --muted:#666; --primary:#1f6feb; --ok:#16a34a; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial; background:var(--bg); color:var(--text); }
    .wrap { max-width: 880px; margin: 24px auto; padding: 0 16px; }
    .card { background:var(--card); border-radius:16px; box-shadow: 0 10px 25px rgba(0,0,0,.06); padding: 20px; }
    h1 { margin: 8px 0 12px; font-size: 24px; }

    /* formulario */
    .row { display:grid; grid-template-columns: repeat(auto-fit, minmax(220px,1fr)); gap:12px; }
    label { font-weight:600; font-size:14px; display:block; margin-bottom:6px; }
    input[type="text"], select { width:100%; padding:10px 12px; border:1px solid #ddd; border-radius:10px; font-size:14px; background:#fff; }

    /* preguntas */
    .q { border-top:1px solid #eee; padding:14px 0; display:flex; justify-content:space-between; gap:16px; align-items:center; }
    .q:first-child { border-top:none; }
    .q-text { flex: 1; font-size:15px; }
    .choices { display:flex; gap:10px; }
    .choices label { font-weight:500; }

    /* progreso */
    .progress { height:8px; background:#eee; border-radius:999px; overflow:hidden; }
    .progress > div { height:100%; width:0%; background:var(--primary); transition:width .2s ease; }

    /* acciones y mensajes */
    .actions { display:flex; gap:12px; flex-wrap:wrap; align-items:center; }
    button { border:0; border-radius:12px; padding:12px 16px; font-weight:700; cursor:pointer; font-size:14px; }
    .btn { background:var(--primary); color:#fff; }
    .btn:disabled { opacity:.7; cursor:default; }
    .btn.sec { background:#e5e7eb; color:#111827; }
    .error { background:#fff7ed; border:1px solid #ffedd5; color:#7c2d12; padding:12px 14px; border-radius:12px; margin-top:12px; display:none; }
    .ok { background:#ecfdf5; border:1px solid #bbf7d0; color:#065f46; padding:12px 14px; border-radius:12px; margin-top:12px; display:none; }

    .foot { text-align:center; margin-top:24px; color:#999; font-size:12px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Test de Áreas – Orientación</h1>
      <p class="muted">Responde las 50 preguntas con Sí/No. Tu docente revisará los resultados.</p>

      <!-- FORM -->
      <div class="row" style="margin-top:10px">
        <div class="col">
          <label>Grado</label>
          <select id="grade">
            <option value="">Selecciona…</option>
            <option value="5">5°</option>
            <option value="8">8°</option>
          </select>
        </div>
        <div class="col">
          <label>Nombre del estudiante</label>
          <input id="studentName" type="text" placeholder="Ej: Ana Pérez" />
        </div>
        <div class="col">
          <label>Código estudiante</label>
          <input id="studentCode" type="text" placeholder="Ej: 2025-091" />
        </div>
        <div class="col">
          <label>Curso / Grupo</label>
          <input id="studentGroup" type="text" placeholder="Ej: 5A / 8B" />
        </div>
      </div>

      <!-- progreso -->
      <div style="margin:14px 0 6px; display:flex; align-items:center; gap:10px;">
        <div class="progress" style="flex:1"><div id="bar"></div></div>
        <span class="muted"><span id="done">0</span>/50</span>
      </div>

      <div id="questions"></div>

      <div class="actions" style="margin-top:14px">
        <button class="btn" id="finishBtn">Finalizar y enviar</button>
        <button class="btn sec" id="clearBtn">Limpiar respuestas</button>
      </div>

      <div class="error" id="errorBox"></div>
      <div class="ok" id="okBox">✅ Respuestas enviadas. ¡Gracias!</div>
    </div>

    <p class="foot">Hecho para la comunidad educativa · 100% gratuito · Sin rastreadores</p>
  </div>

  <script>
    // ========= CONFIG =========
    const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwZqtkr35mlaaPdfK-LIYGvXOrBo3PiRp4-3YZ_4DokDpb9RnEp38Lld75U0cnNQ4BUbg/exec";

    // Áreas
    const AREAS = { IC:"Ingenio y Creatividad", VL:"Voces y Letras", MU:"Musical", CO:"Corporeidad", SL:"Segunda Lengua" };

    // ---- Banco 5º
    const DATA5 = [
      ["Cuando algo no funciona como esperaba, pruebo varias formas hasta lograrlo.", "IC"],
      ["Me gusta organizar información en tablas, listas o pequeños diagramas para entenderla.", "IC"],
      ["Me entretiene descubrir patrones en juegos, apps o situaciones del día a día.", "IC"],
      ["Antes de decidir, comparo ventajas y riesgos y elijo la opción más razonable.", "IC"],
      ["Me siento cómodo siguiendo instrucciones técnicas y ajustándolas si es necesario.", "IC"],
      ["Disfruto resolver acertijos numéricos o lógicos sin rendirme rápido.", "IC"],
      ["Suelo proponer atajos para hacer tareas más rápido sin perder calidad.", "IC"],
      ["Exploro funciones nuevas en herramientas digitales por curiosidad.", "IC"],
      ["Me interesa entender cómo se conectan causas y efectos en un sistema.", "IC"],
      ["Prefiero medir y registrar resultados para comparar después.", "IC"],
      ["Organizo mis ideas en introducción, desarrollo y cierre al escribir.", "VL"],
      ["Identifico el punto de vista y los argumentos principales en un texto o video.", "VL"],
      ["Reescribo mis textos para mejorar precisión y coherencia.", "VL"],
      ["Disfruto investigar varias fuentes para entender un tema polémico.", "VL"],
      ["En debates, respaldo mi opinión con ejemplos o datos concretos.", "VL"],
      ["Puedo resumir información extensa sin perder lo esencial.", "VL"],
      ["Distingo entre hecho, opinión y argumento en lo que leo.", "VL"],
      ["Identifico sesgos o intenciones en noticias y publicaciones.", "VL"],
      ["Encuentro la palabra exacta para expresar una idea compleja.", "VL"],
      ["Me gusta leer por interés personal, no solo por tareas.", "VL"],
      ["Mantengo un pulso constante al aplaudir o marcar tiempos.", "MU"],
      ["Distingo notas o instrumentos interpretados al escuchar una canción.", "MU"],
      ["Aprendo patrones rítmicos por imitación con facilidad.", "MU"],
      ["Puedo recordar y repetir una melodía corta afinando lo mejor posible.", "MU"],
      ["Me siento cómodo practicando fragmentos hasta que suenen limpios.", "MU"],
      ["Coordino respiración o movimiento con la música cuando canto o toco.", "MU"],
      ["Identifico cuándo una nota suena desafinada y la corrijo.", "MU"],
      ["Sigo indicaciones musicales básicas como fuerte, suave, rápido o lento.", "MU"],
      ["Disfruto crear pequeñas ideas musicales o variaciones propias.", "MU"],
      ["Trabajo en grupo para ajustar entradas, silencios y balance de sonido.", "MU"],
      ["Aprendo secuencias de movimientos por partes y las integro en conjunto.", "CO"],
      ["Coordino brazos y piernas con precisión en actividades físicas.", "CO"],
      ["Mantengo una postura estable y controlo el equilibrio al moverme.", "CO"],
      ["Identifico y corrijo detalles técnicos en mis movimientos.", "CO"],
      ["Mejoro con la repetición, notando avances en fuerza, flexibilidad o agilidad.", "CO"],
      ["Expreso emociones o historias usando el cuerpo, rostro y espacio.", "CO"],
      ["Respeto tiempos de descanso, hidratación y calentamiento en la práctica.", "CO"],
      ["Colaboro en equipos, rotando roles y siguiendo reglas del juego.", "CO"],
      ["Persevero cuando un ejercicio exige disciplina y constancia.", "CO"],
      ["Me ubico en escena o cancha teniendo en cuenta posiciones.", "CO"],
      ["Puedo comprender la idea principal de un texto breve en inglés o francés.", "SL"],
      ["Reconozco vocabulario nuevo usando contexto sin traducir palabra por palabra.", "SL"],
      ["Mantengo una conversación sencilla sobre temas cotidianos.", "SL"],
      ["Pronuncio intentando imitar ritmo y entonación del idioma.", "SL"],
      ["Escribo mensajes cortos con la estructura básica correcta.", "SL"],
      ["Escucho audios y capto instrucciones o datos específicos en otro idioma.", "SL"],
      ["Aprendo y aplico reglas gramaticales comunes cuando practico.", "SL"],
      ["Busco oportunidades para usar otro idioma fuera de clase.", "SL"],
      ["Me apoyo en frases modelo y luego las adapto a mi idea.", "SL"],
      ["Puedo explicar en español qué entendí de algo en la otra lengua.", "SL"]
    ];

    // ---- Banco 8º
    const DATA8 = [
      ["Cuando tienes un reto personal o actividad por desarrollar, sueles probar varias formas hasta que funciona.", "IC"],
      ["Te resulta natural estimar cuánto tardará una tarea y cumplirlo.", "IC"],
      ["Disfrutas armando o desarmando objetos para ver cómo funcionan.", "IC"],
      ["Te gusta encontrar patrones en números, figuras o situaciones.", "IC"],
      ["Prefieres juegos que pidan estrategia sobre los de únicamente suerte.", "IC"],
      ["Te emocionan las noticias sobre inventos o descubrimientos.", "IC"],
      ["Usas aplicaciones o herramientas digitales para resolver problemas.", "IC"],
      ["Te sientes cómodo siguiendo pasos precisos para lograr un resultado.", "IC"],
      ["Te atraen preguntas como ¿por qué sucede esto? y ¿cómo comprobarlo?", "IC"],
      ["Te divierte optimizar una actividad, hacerlo más rápido o con menos pasos.", "IC"],
      ["Puedes explicar una idea con ejemplos claros para que otros la entiendan.", "VL"],
      ["Lees por gusto al menos algunas páginas a la semana.", "VL"],
      ["Te fijas en detalles como títulos, fechas, lugares cuando cuentas una historia.", "VL"],
      ["Disfrutas investigar sobre personas, culturas o hechos del pasado.", "VL"],
      ["Te gusta debatir con respeto y argumentar tus puntos.", "VL"],
      ["Tomas notas organizadas y luego las usas para estudiar o crear.", "VL"],
      ["Te atrae crear relatos, crónicas, reseñas o diarios.", "VL"],
      ["Sueles preguntar cómo afectan las decisiones a la comunidad.", "VL"],
      ["Te interesa comprender reglas del idioma para escribir mejor.", "VL"],
      ["Al escuchar una historia, imaginas cómo continuaría o cambiaría el final.", "VL"],
      ["Reconoces ritmos con facilidad y los repites con palmas o golpes suaves.", "MU"],
      ["Puedes tararear melodías que escuchaste hace tiempo.", "MU"],
      ["Te gusta aprender secuencias musicales paso a paso hasta que salgan limpias.", "MU"],
      ["Identificas cuando alguien canta desafinado o fuera de tiempo.", "MU"],
      ["Disfrutas participar en presentaciones frente a público con música.", "MU"],
      ["Mantienes un pulso constante mientras realizas otra tarea.", "MU"],
      ["Te interesa conocer distintos instrumentos y sus sonidos.", "MU"],
      ["Te motiva practicar una pieza varias veces para perfeccionarla.", "MU"],
      ["Te emocionan canciones por sus armonías o arreglos, no solo por la letra.", "MU"],
      ["Sigues indicaciones de un director o líder de grupo con atención.", "MU"],
      ["Te expresas con el cuerpo para mostrar ideas o emociones.", "CO"],
      ["Aprendes movimientos nuevos observando y repitiendo.", "CO"],
      ["Disfrutas actividades que requieren coordinación y control del cuerpo.", "CO"],
      ["Mantienes constancia al entrenar o ensayar hasta mejorar.", "CO"],
      ["Te adaptas a trabajar en equipo dentro de una coreografía o juego.", "CO"],
      ["Te llama la atención el vestuario, la puesta en escena y el espacio.", "CO"],
      ["Manejas tu respiración cuando haces esfuerzo o te presentas.", "CO"],
      ["Te sientes cómodo improvisando gestos o movimientos.", "CO"],
      ["Cuidas tu postura y calentamiento para evitar molestias.", "CO"],
      ["Te entusiasma presentarte frente a otros en obras, danzas o torneos.", "CO"],
      ["Entiendes instrucciones básicas cuando alguien te habla en otro idioma.", "SL"],
      ["Te gusta adoptar nuevas palabras y pronunciarlas hasta que salgan mejor.", "SL"],
      ["Pierdes la pena al equivocarte si con eso practicas más.", "SL"],
      ["Reconoces sonidos que no existen en tu idioma y los imitas.", "SL"],
      ["Puedes recordar frases útiles para situaciones cotidianas.", "SL"],
      ["Te interesa conocer costumbres de países donde se habla otro idioma.", "SL"],
      ["Relacionas palabras nuevas con imágenes, gestos o contextos.", "SL"],
      ["Usas canciones, juegos o videos para aprender vocabulario.", "SL"],
      ["Te organizas para estudiar un poco cada día en lugar de todo al final.", "SL"],
      ["Te animas a conversar en otro idioma, aunque no tengas todas las palabras.", "SL"]
    ];

    // estado
    let DATA = [];
    let answers = Array(50).fill(null);

    // util: mezclar
    function shuffle(arr) {
      const a = [...arr];
      for (let i=a.length-1; i>0; i--) {
        const j = Math.floor(Math.random() * (i+1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    // refs
    const $q = document.getElementById('questions');
    const $bar = document.getElementById('bar');
    const $done = document.getElementById('done');
    const $error = document.getElementById('errorBox');
    const $ok = document.getElementById('okBox');

    function showError(msg) {
      $error.textContent = msg;
      $error.style.display = 'block';
      setTimeout(()=> $error.style.display = 'none', 4500);
    }

    // render preguntas
    function renderQuestions() {
      $q.innerHTML = '';
      DATA.forEach(([text, area], i) => {
        const wrap = document.createElement('div');
        wrap.className = 'q';

        const left = document.createElement('div');
        left.className = 'q-text';
        left.textContent = `${i+1}. ${text}`;

        const right = document.createElement('div');
        right.className = 'choices';
        right.innerHTML = `
          <label><input type="radio" name="q${i}" value="si" /> Sí</label>
          <label><input type="radio" name="q${i}" value="no" /> No</label>
        `;
        right.querySelectorAll('input[type="radio"]').forEach(r => {
          r.addEventListener('change', (ev) => {
            answers[i] = (ev.target.value === 'si');
            updateProgress();
          });
        });

        wrap.appendChild(left);
        wrap.appendChild(right);
        $q.appendChild(wrap);
      });
    }

    function updateProgress() {
      const done = answers.filter(a => a !== null).length;
      $done.textContent = done;
      $bar.style.width = (done / DATA.length * 100) + '%';
    }

    function computeScores() {
      const scores = { IC:0, VL:0, MU:0, CO:0, SL:0 };
      DATA.forEach(([_, area], i) => { if (answers[i] === true) scores[area] += 1; });
      const vals = Object.values(scores);
      const max = Math.max(...vals);
      const topAreas = Object.entries(scores).filter(([k,v]) => v === max).map(([k]) => AREAS[k]);
      return { scores, topAreas };
    }

    async function submitToSheet(payload) {
      try {
        await fetch(APPS_SCRIPT_URL, {
          method: 'POST',
          mode: 'no-cors',
          headers: { 'Content-Type': 'text/plain' },
          body: JSON.stringify(payload)
        });
      } catch (e) { /* no response in no-cors */ }
    }

    function loadByGrade(grade) {
      DATA = shuffle(grade === '5' ? DATA5 : DATA8);
      answers = Array(DATA.length).fill(null);
      renderQuestions();
      updateProgress();
      $ok.style.display = 'none';
    }

    document.getElementById('grade').addEventListener('change', (e) => {
      const g = e.target.value;
      if (g === '5' || g === '8') loadByGrade(g);
    });

    // finalizar
    const $finish = document.getElementById('finishBtn');
    document.getElementById('finishBtn').addEventListener('click', async () => {
      const grade = document.getElementById('grade').value.trim();
      const name  = document.getElementById('studentName').value.trim();
      const code  = document.getElementById('studentCode').value.trim();
      const group = document.getElementById('studentGroup').value.trim();

      if (!grade || !name || !code || !group) return showError('Completa Grado, Nombre, Código y Curso/Grupo.');
      if (answers.some(a => a === null)) return showError('Responde todas las preguntas antes de finalizar.');

      $finish.disabled = true;

      const { scores, topAreas } = computeScores();
      const payload = {
        grade,
        studentName: name,
        studentCode: code,
        studentGroup: group,
        totals: {
          "Ingenio y Creatividad": scores.IC,
          "Voces y Letras": scores.VL,
          "Musical": scores.MU,
          "Corporeidad": scores.CO,
          "Segunda Lengua": scores.SL
        },
        topAreas
      };

      await submitToSheet(payload);
      $ok.style.display = 'block';
      window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });

      setTimeout(()=>{ $finish.disabled = false; }, 2000);
    });

    document.getElementById('clearBtn').addEventListener('click', () => {
      document.querySelectorAll('input[type="radio"]').forEach(r => r.checked = false);
      if (DATA.length) answers = Array(DATA.length).fill(null);
      updateProgress();
      $ok.style.display = 'none';
    });
  </script>
</body>
</html>