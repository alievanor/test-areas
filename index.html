<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Test de Áreas – Orientación</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --bg:#f7f7fb; --card:#fff; --text:#222; --muted:#666; --primary:#1f6feb; --ok:#16a34a; --warn:#b45309; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial; background:var(--bg); color:var(--text); }
    .wrap { max-width: 880px; margin: 24px auto; padding: 0 16px; }
    .card { background:var(--card); border-radius:16px; box-shadow: 0 10px 25px rgba(0,0,0,.06); padding: 20px; }
    h1 { margin: 8px 0 12px; font-size: 24px; }
    .row { display:flex; gap:16px; flex-wrap:wrap; }
    .col { flex:1 1 280px; }
    label { font-weight:600; font-size:14px; display:block; margin-bottom:6px; }
    input[type="text"] { width:100%; padding:10px 12px; border:1px solid #ddd; border-radius:10px; font-size:14px; }
    .q { border-top:1px solid #eee; padding:14px 0; display:flex; justify-content:space-between; gap:16px; align-items:center; }
    .q:first-child { border-top:none; }
    .q-text { flex: 1; font-size:15px; }
    .choices { display:flex; gap:10px; }
    .choices label { font-weight:500; }
    .pill { display:inline-block; background:#eef2ff; color:#3730a3; border-radius:999px; padding:2px 10px; font-size:12px; margin-left:6px; }
    .actions { display:flex; gap:12px; flex-wrap:wrap; align-items:center; }
    button { border:0; border-radius:12px; padding:12px 16px; font-weight:700; cursor:pointer; font-size:14px; }
    .btn { background:var(--primary); color:#fff; }
    .btn.sec { background:#e5e7eb; color:#111827; }
    .muted { color:var(--muted); font-size:13px; }
    .result { background:#f0fdf4; border:1px solid #dcfce7; color:#14532d; padding:12px 14px; border-radius:12px; margin-top:12px; display:none; }
    .error { background:#fff7ed; border:1px solid #ffedd5; color:#7c2d12; padding:12px 14px; border-radius:12px; margin-top:12px; display:none; }
    .scores { display:grid; grid-template-columns: repeat(5,minmax(0,1fr)); gap:8px; margin-top:8px; }
    .score { background:#f9fafb; border:1px solid #eee; border-radius:12px; padding:10px; text-align:center; }
    .progress { height:8px; background:#eee; border-radius:999px; overflow:hidden; }
    .progress > div { height:100%; width:0%; background:var(--primary); }
    .foot { text-align:center; margin-top:24px; color:#999; font-size:12px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Test de Áreas – Orientación</h1>
      <p class="muted">50 preguntas, respuestas Sí/No. Al final verás tu área sugerida y se enviará el resultado al docente.</p>

<div class="row" style="margin-top:10px">
  <div class="col">
    <label>Nombre del estudiante</label>
    <input id="studentName" type="text" placeholder="Ej: Ana Pérez" />
  </div>
  <div class="col">
    <label>Código estudiante</label>
    <input id="studentCode" type="text" placeholder="Ej: 2025-091" />
  </div>
  <div class="col">
    <label>Curso / Grupo</label>
    <input id="studentGroup" type="text" placeholder="Ej: 9A" />
  </div>
</div>

      <div style="margin:14px 0 6px; display:flex; align-items:center; gap:10px;">
        <div class="progress" style="flex:1"><div id="bar"></div></div>
        <span class="muted"><span id="done">0</span>/50</span>
      </div>

      <div id="questions"></div>

      <div class="actions" style="margin-top:14px">
        <button class="btn" id="finishBtn">Finalizar y enviar</button>
        <button class="btn sec" id="clearBtn">Limpiar respuestas</button>
      </div>

      <div class="result" id="resultBox"></div>
      <div class="error" id="errorBox"></div>

      <div class="scores" id="scoresGrid" style="display:none"></div>
    </div>

    <p class="foot">Hecho para la comunidad educativa · 100% gratuito · Sin rastreadores</p>
  </div>

  <script>
    // ================== CONFIG ==================
    const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyl2jYnFtGW0XYyc1XnmdXbUfuEjwDWu_M-W9jKFET-sTKac6WCfH0YeQHTAVvIKGWNiA/exec";


    const AREAS = {
      IC: "Ingenio y Creatividad",
      VL: "Voces y Letras",
      MU: "Musical",
      CO: "Corporeidad",
      SL: "Segunda Lengua"
    };

    const DATA = [
      ["Cuando tienes un reto personal o actividad por desarrollar, sueles probar varias formas hasta que funciona.", "IC"],
      ["Te resulta natural estimar cuánto tardará una tarea y cumplirlo.", "IC"],
      ["Disfrutas armando o desarmando objetos para ver cómo funcionan.", "IC"],
      ["Te gusta encontrar patrones en números, figuras o situaciones.", "IC"],
      ["Prefieres juegos que pidan estrategia sobre los de únicamente suerte.", "IC"],
      ["Te emocionan las noticias sobre inventos o descubrimientos.", "IC"],
      ["Usas aplicaciones o herramientas digitales para resolver problemas.", "IC"],
      ["Te sientes cómodo siguiendo pasos precisos para lograr un resultado.", "IC"],
      ["Te atraen preguntas como ¿por qué sucede esto? y ¿cómo comprobarlo?", "IC"],
      ["Te divierte optimizar una actividad, hacerlo más rápido o con menos pasos.", "IC"],

      ["Puedes explicar una idea con ejemplos claros para que otros la entiendan.", "VL"],
      ["Lees por gusto al menos algunas páginas a la semana.", "VL"],
      ["Te fijas en detalles como títulos, fechas, lugares cuando cuentas una historia.", "VL"],
      ["Disfrutas investigar sobre personas, culturas o hechos del pasado.", "VL"],
      ["Te gusta debatir con respeto y argumentar tus puntos.", "VL"],
      ["Tomas notas organizadas y luego las usas para estudiar o crear.", "VL"],
      ["Te atrae crear relatos, crónicas, reseñas o diarios.", "VL"],
      ["Sueles preguntar cómo afectan las decisiones a la comunidad.", "VL"],
      ["Te interesa comprender reglas del idioma para escribir mejor.", "VL"],
      ["Al escuchar una historia, imaginas cómo continuaría o cambiaría el final.", "VL"],

      ["Reconoces ritmos con facilidad y los repites con palmas o golpes suaves.", "MU"],
      ["Puedes tararear melodías que escuchaste hace tiempo.", "MU"],
      ["Te gusta aprender secuencias musicales paso a paso hasta que salgan limpias.", "MU"],
      ["Identificas cuando alguien canta desafinado o fuera de tiempo.", "MU"],
      ["Disfrutas participar en presentaciones frente a público con música.", "MU"],
      ["Mantienes un pulso constante mientras realizas otra tarea.", "MU"],
      ["Te interesa conocer distintos instrumentos y sus sonidos.", "MU"],
      ["Te motiva practicar una pieza varias veces para perfeccionarla.", "MU"],
      ["Te emocionan canciones por sus armonías o arreglos, no solo por la letra.", "MU"],
      ["Sigues indicaciones de un director o líder de grupo con atención.", "MU"],

      ["Te expresas con el cuerpo para mostrar ideas o emociones.", "CO"],
      ["Aprendes movimientos nuevos observando y repitiendo.", "CO"],
      ["Disfrutas actividades que requieren coordinación y control del cuerpo.", "CO"],
      ["Mantienes constancia al entrenar o ensayar hasta mejorar.", "CO"],
      ["Te adaptas a trabajar en equipo dentro de una coreografía o juego.", "CO"],
      ["Te llama la atención el vestuario, la puesta en escena y el espacio.", "CO"],
      ["Manejas tu respiración cuando haces esfuerzo o te presentas.", "CO"],
      ["Te sientes cómodo improvisando gestos o movimientos.", "CO"],
      ["Cuidas tu postura y calentamiento para evitar molestias.", "CO"],
      ["Te entusiasma presentarte frente a otros en obras, danzas o torneos.", "CO"],

      ["Entiendes instrucciones básicas cuando alguien te habla en otro idioma.", "SL"],
      ["Te gusta adoptar nuevas palabras y pronunciarlas hasta que salgan mejor.", "SL"],
      ["Pierdes la pena al equivocarte si con eso practicas más.", "SL"],
      ["Reconoces sonidos que no existen en tu idioma y los imitas.", "SL"],
      ["Puedes recordar frases útiles para situaciones cotidianas.", "SL"],
      ["Te interesa conocer costumbres de países donde se habla otro idioma.", "SL"],
      ["Relacionas palabras nuevas con imágenes, gestos o contextos.", "SL"],
      ["Usas canciones, juegos o videos para aprender vocabulario.", "SL"],
      ["Te organizas para estudiar un poco cada día en lugar de todo al final.", "SL"],
      ["Te animas a conversar en otro idioma, aunque no tengas todas las palabras.", "SL"],
    ];

    // ================== RENDER ==================
    const $q = document.getElementById('questions');
    const $bar = document.getElementById('bar');
    const $done = document.getElementById('done');
    const $result = document.getElementById('resultBox');
    const $error = document.getElementById('errorBox');
    const $scoresGrid = document.getElementById('scoresGrid');

    const answers = Array(DATA.length).fill(null);

    function renderQuestions() {
  $q.innerHTML = '';
  DATA.forEach(([text, area], i) => {
    const wrap = document.createElement('div');
    wrap.className = 'q';

    const left = document.createElement('div');
    left.className = 'q-text';
    left.innerHTML = `<span>${i+1}. ${text}</span> <span class="pill">${AREAS[area]}</span>`;

    const right = document.createElement('div');
    right.className = 'choices';
    right.innerHTML = `
      <label><input type="radio" name="q${i}" value="si" /> Sí</label>
      <label><input type="radio" name="q${i}" value="no" /> No</label>
    `;

    right.querySelectorAll('input[type="radio"]').forEach(r => {
      r.addEventListener('change', (ev) => {
        answers[i] = (ev.target.value === 'si');
        updateProgress();
      });
    });

    wrap.appendChild(left);
    wrap.appendChild(right);
    $q.appendChild(wrap);
  });
}
    function updateProgress() {
      const done = answers.filter(a => a !== null).length;
      $done.textContent = done;
      $bar.style.width = (done / DATA.length * 100) + '%';
    }

    function computeScores() {
      const scores = { IC:0, VL:0, MU:0, CO:0, SL:0 };
      const detail = DATA.map((row, i) => {
        const [text, area] = row;
        const ok = answers[i] === true;
        if (ok) scores[area] += 1;
        return { idx:i+1, text, area, yes: ok };
      });
      const max = Math.max(...Object.values(scores));
      const topAreas = Object.entries(scores)
        .filter(([k,v]) => v === max)
        .map(([k]) => AREAS[k]);
      return { scores, detail, topAreas, max };
    }

    function drawScores(scores) {
      $scoresGrid.style.display = 'grid';
      $scoresGrid.innerHTML = '';
      const order = ["IC","VL","MU","CO","SL"];
      order.forEach(k => {
        const div = document.createElement('div');
        div.className = 'score';
        div.innerHTML = `<div style="font-size:12px; color:#555">${AREAS[k]}</div>
                         <div style="font-size:22px; font-weight:800">${scores[k]}/10</div>`;
        $scoresGrid.appendChild(div);
      });
    }

    function showError(msg) {
      $error.textContent = msg;
      $error.style.display = 'block';
      setTimeout(()=> $error.style.display = 'none', 4500);
    }

    async function submitToSheet(payload) {
  const res = await fetch(APPS_SCRIPT_URL, {
    method: 'POST',
    mode: 'cors',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(payload)
  });
  if (!res.ok) {
    console.warn('Apps Script error:', res.status, await res.text().catch(()=>'')); 
  }
}

document.getElementById('finishBtn').addEventListener('click', async () => {
  const name  = document.getElementById('studentName').value.trim();
  const code  = document.getElementById('studentCode').value.trim();
  const group = document.getElementById('studentGroup').value.trim();

  if (!name || !code || !group) {
    return showError('Por favor completa Nombre, Código estudiante y Curso/Grupo.');
  }
  if (answers.some(a => a === null)) {
    return showError('Responde todas las preguntas antes de finalizar.');
  }

  const { scores, detail, topAreas, max } = computeScores();
  drawScores(scores);

  $result.style.display = 'block';
  $result.innerHTML = `<strong>Área sugerida:</strong> ${topAreas.join(' y ')} 
                       <br/><span class="muted">Puntaje máximo: ${max} / 10</span>`;

  const payload = {
    studentName: name,
    studentCode: code,              // <--- NUEVO
    studentGroup: group,
    totals: {
      "Ingenio y Creatividad": scores.IC,
      "Voces y Letras": scores.VL,
      "Musical": scores.MU,
      "Corporeidad": scores.CO,
      "Segunda Lengua": scores.SL
    },
    topAreas,
    answers: detail,
    userAgent: navigator.userAgent,
    ts: new Date().toISOString()
  };

  await submitToSheet(payload);
  window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
});

    document.getElementById('clearBtn').addEventListener('click', () => {
      document.querySelectorAll('input[type="radio"]').forEach(r => r.checked = false);
      for (let i=0;i<answers.length;i++) answers[i] = null;
      updateProgress();
      $scoresGrid.style.display = 'none';
      $result.style.display = 'none';
    });

    renderQuestions();
    updateProgress();
  </script>
</body>
</html>
