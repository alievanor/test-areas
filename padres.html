<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<title>Consejerías Escolares – Orientación escolar EOH (Padres)</title>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<style>
  :root{--bg:#f7f8fb;--card:#fff;--text:#222;--muted:#6b7280;--primary:#1f6feb;}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--text)}
  .wrap{max-width:900px;margin:22px auto;padding:0 16px}
  .card{background:var(--card);border-radius:16px;box-shadow:0 8px 24px rgba(0,0,0,.08);padding:20px}
  h1{margin:6px 0 10px;font-size:24px}
  .muted{color:var(--muted);font-size:14px}
  .row{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:14px}
  .row-2col{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:12px}
  .row-1col{display:grid;grid-template-columns:1fr;gap:12px;margin-top:12px}
  label{font-weight:600;font-size:14px}
  input,select,textarea{width:100%;padding:10px 12px;border:1px solid #e5e7eb;border-radius:10px;font-size:14px}
  textarea{min-height:60px;resize:vertical}
  .q{border-top:1px solid #eee;padding:14px 0;display:flex;justify-content:space-between;gap:16px;align-items:center}
  .choices{display:flex;gap:12px}
  .actions{display:flex;gap:12px;margin-top:14px;flex-wrap:wrap}
  button{border:0;border-radius:12px;padding:12px 16px;font-weight:700;cursor:pointer;font-size:14px}
  .btn{background:var(--primary);color:#fff}
  .btn.sec{background:#e5e7eb;color:#111827}
  .ok{background:#ecfdf5;border:1px solid #d1fae5;color:#065f46;padding:12px;border-radius:12px;display:none}
  .err{background:#fff7ed;border:1px solid #ffedd5;color:#7c2d12;padding:12px;border-radius:12px;display:none}
  @media (max-width:720px){.row{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>Consejerías Escolares – Orientación escolar EOH (Padres)</h1>
    <p class="muted">Instrucciones: Responda todas las preguntas con <strong>Sí / No / No estoy seguro(a)</strong>. Este formulario es para acudientes.</p>

    <div class="row">
      <div>
        <label>Nivel</label>
        <select id="level">
            <option value="">Selecciona…</option>
            <option value="Primaria">Primaria</option>
            <option value="Bachillerato">Bachillerato</option>
        </select>
      </div>
      <div>
        <label>Jornada</label>
        <select id="shift">
            <option value="">Selecciona…</option>
            <option value="Mañana">Mañana</option>
            <option value="Tarde">Tarde</option>
        </select>
      </div>
      <div>
        <label>Curso (3 dígitos)</label>
        <input id="course" maxlength="3" placeholder="Ej: 502" />
      </div>
    </div>

    <div class="row-2col">
      <div>
        <label>Nombre del estudiante (Nombre y Apellido)</label>
        <input id="studentName" placeholder="Ej: Ana Pérez"/>
      </div>
    </div>

    <div class="row-1col">
      <div>
        <label>Nombre del acudiente</label>
        <input id="guardianName" placeholder="Ej: Juan Pérez"/>
      </div>
      <div>
        <label>Observaciones del acudiente (opcional)</label>
        <textarea id="observations" placeholder="Comentarios u observaciones..."></textarea>
      </div>
    </div>

    <div id="questions"></div>

    <div class="actions">
      <button class="btn" id="submitBtn">Finalizar y enviar</button>
      <button class="btn sec" id="clearBtn">Limpiar respuestas</button>
    </div>

    <div id="okBox"  class="ok">✔ Respuestas enviadas, ¡gracias!</div>
    <div id="errBox" class="err"></div>
  </div>
</div>

<script>
// ================= CONFIG =================
const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzzMjOgNczfVqKwaw6Kj0OBg2X86jYYzXLZDuUjPIwhkhtPm2KpTGA4CR9aOL7FOLIxFQ/exec';

const A = { IC:'Ingenio y Creatividad', VL:'Voces y Letras', MU:'Musical', CO:'Corporeidad', SL:'Segunda Lengua' };

const P5 = {
  IC: [
    'Mi hijo(a) disfruta armar, desarmar o construir cosas.',
    'Le interesa descubrir cómo funcionan los objetos o aparatos.',
    'Le gusta resolver problemas o acertijos de lógica y números.',
    'Se muestra curioso(a) y busca distintas formas de solucionar algo.',
    'Le atraen los juegos que implican estrategia o razonamiento.',
    'Usa con facilidad herramientas tecnológicas o programas digitales.'
  ],
  VL: [
    'Le gusta leer libros, revistas o cuentos por iniciativa propia.',
    'Suele contar historias con muchos detalles.',
    'Se interesa por escribir o dibujar lo que imagina.',
    'Expresa sus ideas con claridad cuando habla.',
    'Disfruta escuchar y opinar sobre temas variados.',
    'Tiene facilidad para recordar información que lee o escucha.'
  ],
  MU: [
    'Muestra gusto por cantar o tocar algún instrumento.',
    'Tiene facilidad para seguir el ritmo al aplaudir o moverse.',
    'Recuerda melodías y las tararea con frecuencia.',
    'Disfruta participar en actividades musicales o presentaciones.',
    'Es perseverante cuando ensaya una canción o ritmo nuevo.'
  ],
  CO: [
    'Le gusta practicar deportes, bailar o actuar.',
    'Tiene buena coordinación y equilibrio.',
    'Cuida su postura y movimientos cuando hace ejercicio.',
    'Disfruta participar en equipos o grupos artísticos.',
    'Se esfuerza por mejorar sus movimientos o habilidades físicas.'
  ],
  SL: [
    'Se interesa por aprender palabras en otro idioma.',
    'Le gusta escuchar música, ver videos o jugar en inglés u otro idioma.',
    'Imitar pronunciaciones nuevas le resulta divertido.',
    'Usa palabras o frases que aprende en contextos cotidianos.',
    'Se esfuerza por comunicarse aunque no domine todas las palabras.'
  ]
};

const P8 = {
  IC: [
    'Muestra interés por entender cómo funcionan las cosas.',
    'Se siente motivado(a) al resolver problemas o desafíos.',
    'Le gusta investigar o buscar explicaciones sobre lo que no entiende.',
    'Usa la tecnología como una herramienta para crear o solucionar.',
    'Propone formas diferentes de realizar una tarea o proyecto.',
    'Le atraen temas relacionados con ciencia, lógica o innovación.'
  ],
  VL: [
    'Se expresa con claridad y usa argumentos para defender sus ideas.',
    'Disfruta leer sobre temas que le interesan.',
    'Le gusta escribir textos, reflexiones o relatos.',
    'Muestra sensibilidad hacia temas sociales o culturales.',
    'Tiene buena ortografía y se preocupa por mejorar su forma de escribir.',
    'Participa con gusto en debates, exposiciones o dramatizaciones.'
  ],
  MU: [
    'Tiene sensibilidad para identificar ritmo, melodía o afinación.',
    'Dedica tiempo a practicar su instrumento o mejorar su canto.',
    'Disfruta crear o interpretar música en grupo.',
    'Se interesa por conocer distintos géneros musicales.',
    'Se siente motivado(a) al participar en presentaciones musicales.'
  ],
  CO: [
    'Se expresa con el cuerpo a través de danza, teatro o deporte.',
    'Muestra disciplina en los entrenamientos o ensayos.',
    'Le gusta participar en eventos deportivos o artísticos.',
    'Cuida su cuerpo y reconoce la importancia del calentamiento y la hidratación.',
    'Demuestra liderazgo o colaboración en actividades grupales.'
  ],
  SL: [
    'Se interesa por aprender y practicar otro idioma.',
    'Usa recursos digitales o artísticos para mejorar su comprensión.',
    'Intenta comunicarse en otro idioma sin miedo a equivocarse.',
    'Se interesa por conocer culturas de otros países.',
    'Tiene facilidad para recordar y aplicar nuevo vocabulario.'
  ]
};


const $q = document.getElementById('questions');
let ANSW = [];

function buildQuestions() {
  const level = document.getElementById('level').value;
  const src = (level === 'Primaria') ? P5 : P8;

  const all = [];
  Object.entries(src).forEach(([k, arr]) => {
    arr.forEach(t => all.push({ area:k, text:t }));
  });
  shuffle(all);
  ANSW = all.map(o => ({ ...o, ans: null }));

  $q.innerHTML = '';
  ANSW.forEach((q, i) => {
    const row = document.createElement('div');
    row.className = 'q';
    row.innerHTML = `
      <div style="flex:1">${i+1}. ${q.text}</div>
      <div class="choices">
        <label><input type="radio" name="q${i}" value="si"> Sí</label>
        <label><input type="radio" name="q${i}" value="no"> No</label>
        <label><input type="radio" name="q${i}" value="ns"> No estoy seguro(a)</label>
      </div>`;
    row.querySelectorAll('input').forEach(r => {
      r.addEventListener('change', ev => { q.ans = ev.target.value; });
    });
    $q.appendChild(row);
  });
}
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}}

document.getElementById('level').addEventListener('change', buildQuestions);
buildQuestions();

// ========= envío =========
const $ok = document.getElementById('okBox');
const $err = document.getElementById('errBox');

document.getElementById('submitBtn').addEventListener('click', async () => {
  $ok.style.display='none'; $err.style.display='none';

  const level  = document.getElementById('level').value;
  const shift  = document.getElementById('shift').value;
  const course = document.getElementById('course').value.trim();
  const studentName  = document.getElementById('studentName').value.trim();
  const guardianName = document.getElementById('guardianName').value.trim();
  const observations = document.getElementById('observations').value || ''; // << SIEMPRE viaja


  if (!/^\d{3}$/.test(course)) return showErr('El curso debe tener exactamente 3 dígitos.');
  if (studentName.split(/\s+/).length < 2) return showErr('Ingrese nombre y apellido del estudiante.');
  if (!guardianName) return showErr('Ingrese el nombre del acudiente.');
  if (ANSW.some(x => x.ans === null)) return showErr('Responda todas las preguntas.');


  const totals = { IC:0, VL:0, MU:0, CO:0, SL:0 };
  ANSW.forEach(q => { if (q.ans === 'si') totals[q.area] += 1; });
  const max = Math.max(...Object.values(totals));
  const topAreas = Object.entries(totals).filter(([k,v]) => v === max).map(([k]) => A[k]);


  const payload = {
    role: 'parent',
    level,
    shift,
    course,
    studentName,
    guardianName,
    totals,
    topAreas,
    observations,
    ts: new Date().toISOString()
  };

  try {
    await fetch(APPS_SCRIPT_URL, {
      method:'POST',
      mode:'no-cors',
      headers:{ 'Content-Type':'text/plain' },
      body: JSON.stringify(payload)
    });
    $ok.style.display='block';
    window.scrollTo({ top: document.body.scrollHeight, behavior:'smooth' });
  } catch (e) {
    showErr('No se pudo enviar. Revise conexión e intente nuevamente.');
  }
});

document.getElementById('clearBtn').addEventListener('click', ()=>{
  document.querySelectorAll('input[type=radio]').forEach(r=> r.checked=false);
  ANSW.forEach(q=> q.ans=null);
  document.getElementById('observations').value='';
});

function showErr(m){$err.textContent=m;$err.style.display='block'}
</script>
</body>
</html>
